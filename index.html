<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Frequency Pharmacy">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192'%3E%3Crect width='192' height='192' fill='%231a1a2e'/%3E%3Ctext x='50%25' y='50%25' font-size='80' fill='%236adcff' dominant-baseline='middle' text-anchor='middle'%3E∿%3C/text%3E%3C/svg%3E">
    <title>Digital Sound Therapy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-card: rgba(26, 26, 46, 0.6);
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #6adcff;
            --accent-hover: #5ac8eb;
            --border: rgba(106, 220, 255, 0.2);
            --shadow: rgba(0, 0, 0, 0.3);
            --gradient: linear-gradient(135deg, rgba(106, 220, 255, 0.1), rgba(138, 99, 210, 0.1));
        }

        body.light {
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.8);
            --text-primary: #1d1d1f;
            --text-secondary: #6e6e73;
            --accent: #0071e3;
            --accent-hover: #0077ed;
            --border: rgba(0, 113, 227, 0.2);
            --shadow: rgba(0, 0, 0, 0.1);
            --gradient: linear-gradient(135deg, rgba(0, 113, 227, 0.05), rgba(138, 99, 210, 0.05));
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            transition: all 0.3s ease;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: var(--gradient);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(106, 220, 255, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-danger {
            background: #ff4757;
        }

        .btn-danger:hover {
            background: #ee5a6f;
        }

        .master-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px var(--shadow);
        }

        .control-label {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(106, 220, 255, 0.5);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(106, 220, 255, 0.5);
        }

        .value-display {
            min-width: 50px;
            text-align: right;
            font-weight: 600;
            color: var(--accent);
        }

        .frequency-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--accent);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .freq-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .freq-card.active {
            border-color: var(--accent);
            box-shadow: 0 8px 30px rgba(106, 220, 255, 0.3);
            background: var(--gradient);
        }

        .freq-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .freq-info {
            flex: 1;
        }

        .freq-hz {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .freq-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .toggle-btn {
            width: 60px;
            height: 32px;
            border-radius: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .toggle-btn::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-btn.active::after {
            left: 30px;
        }

        .freq-controls {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .freq-card.active .freq-controls {
            display: block;
        }

        .fine-tune {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .fine-tune-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--accent);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
        }

        .fine-tune-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        .current-freq {
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--accent);
        }

        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--bg-card);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px var(--shadow);
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
            background: var(--gradient);
            border-radius: 20px 20px 0 0;
            border-top: 2px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .disclaimer {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .disclaimer strong {
            color: var(--accent);
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .footer-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .version {
            color: var(--accent);
            font-weight: 600;
            margin: 10px 0;
        }

        .credits {
            margin-top: 10px;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .controls-bar {
                flex-direction: column;
            }

            .frequency-grid {
                grid-template-columns: 1fr;
            }
        }

        .icon {
            width: 20px;
            height: 20px;
            stroke-width: 2;
        }
    </style>
</head>
<body class="dark">
    <div class="app-container">
        <header>
            <h1 id="appTitle">Digital Frequency Pharmacy</h1>
            <p class="subtitle" id="appSubtitle">Professional Sound Therapy</p>
        </header>

        <div class="controls-bar">
            <button class="btn btn-secondary" id="themeToggle">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <span id="themeText">Light Mode</span>
            </button>

            <button class="btn btn-secondary" id="langToggle">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                </svg>
                <span id="langText">HU</span>
            </button>

            <button class="btn btn-danger" id="stopAll">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                <span id="stopText">Stop All</span>
            </button>
        </div>

        <div class="master-controls">
            <div class="control-card">
                <div class="control-label">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                    </svg>
                    <span id="masterVolLabel">Master Volume</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="masterVol" min="0" max="100" value="50">
                    <span class="value-display" id="masterVolValue">50%</span>
                </div>
            </div>

            <div class="control-card">
                <div class="control-label">
                    <span id="breathingLabel">Breathing Effect (LFO)</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="lfoDepth" min="0" max="100" value="0">
                    <span class="value-display" id="lfoValue">0%</span>
                </div>
            </div>

            <div class="control-card">
                <div class="control-label">
                    <span id="brownNoiseLabel">Brown Noise Layer</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="brownNoise" min="0" max="100" value="0">
                    <span class="value-display" id="brownNoiseValue">0%</span>
                </div>
            </div>

            <div class="control-card">
                <div class="control-label">
                    <span id="pinkNoiseLabel">Pink Noise (1/f)</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="pinkNoise" min="0" max="100" value="0">
                    <span class="value-display" id="pinkNoiseValue">0%</span>
                </div>
            </div>

            <div class="control-card">
                <div class="control-label">
                    <span id="whiteNoiseLabel">White Noise</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="whiteNoise" min="0" max="100" value="0">
                    <span class="value-display" id="whiteNoiseValue">0%</span>
                </div>
            </div>

            <div class="control-card">
                <div class="control-label">
                    <span id="rainNoiseLabel">Rain Simulation</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="rainNoise" min="0" max="100" value="0">
                    <span class="value-display" id="rainNoiseValue">0%</span>
                </div>
            </div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="chineseTitle">Chinese Pentatonic & Harmonic Frequencies</h2>
            <div class="frequency-grid" id="chineseGrid"></div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="chakraTitle">Chakra Frequencies</h2>
            <div class="frequency-grid" id="chakraGrid"></div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="planetaryTitle">Planetary Frequencies</h2>
            <div class="frequency-grid" id="planetaryGrid"></div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="solfeggioTitle">Solfeggio Frequencies</h2>
            <div class="frequency-grid" id="solfeggioGrid"></div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="rifeTitle">Rife Frequencies</h2>
            <div class="frequency-grid" id="rifeGrid"></div>
        </div>

        <div class="frequency-section">
            <h2 class="section-title" id="brainwaveTitle">Brainwave Frequencies</h2>
            <div class="frequency-grid" id="brainwaveGrid"></div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="disclaimer">
                <strong>⚠️ Disclaimer / Felelősségkizárás</strong>
                <p>This application is provided for informational and personal wellness purposes only. Use at your own risk. The frequencies and sounds provided are not intended to diagnose, treat, cure, or prevent any medical condition. Consult with a healthcare professional before using sound therapy, especially if you have any medical conditions or concerns.</p>
                <br>
                <p>Ez az alkalmazás kizárólag tájékoztató és személyes jóléti célokra szolgál. Használat saját felelősségre. A megadott frekvenciák és hangok nem szolgálnak betegség diagnosztizálására, kezelésére vagy megelőzésére. Egészségügyi szakemberrel konzultáljon hangterápia használata előtt, különösen, ha egészségügyi problémái vannak.</p>
            </div>
            <div class="footer-info">
                <div class="version">Version 1.0.0</div>
                <div class="credits">Made by <strong>MysteryT</strong></div>
                <div class="credits">© 2025 All Rights Reserved</div>
            </div>
        </div>
    </footer>

    <div class="status-indicator" id="statusIndicator" style="display: none;">
        <div class="status-dot"></div>
        <span id="statusText">Active</span>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                appTitle: "Digital Frequency Pharmacy",
                appSubtitle: "Professional Sound Therapy",
                masterVolLabel: "Master Volume",
                breathingLabel: "Breathing Effect (LFO)",
                brownNoiseLabel: "Brown Noise Layer",
                stopText: "Stop All",
                themeText: "Light Mode",
                langText: "HU",
                solfeggioTitle: "Solfeggio Frequencies",
                rifeTitle: "Rife Frequencies",
                brainwaveTitle: "Brainwave Frequencies",
                chineseTitle: "Chinese Pentatonic & Harmonic Frequencies",
                chakraTitle: "Chakra Frequencies",
                planetaryTitle: "Planetary Frequencies",
                ambientTitle: "Ambient Noise Layers",
                pinkNoiseLabel: "Pink Noise (1/f)",
                whiteNoiseLabel: "White Noise",
                rainNoiseLabel: "Rain Simulation",
                statusText: "Active",
                frequencies: {
                    174: "Pain Relief",
                    285: "Tissue Healing",
                    396: "Liberation from Fear",
                    417: "Facilitating Change",
                    528: "DNA Repair",
                    639: "Relationships & Connection",
                    741: "Awakening Intuition",
                    852: "Spiritual Order",
                    963: "Divine Consciousness",
                    727: "General Healing",
                    802: "Infection Fighting",
                    1550: "Injury Repair",
                    5000: "Regeneration",
                    10000: "Full Spectrum Healing",
                    7.83: "Schumann Resonance",
                    4: "Delta - Deep Sleep",
                    10: "Alpha - Relaxation",
                    40: "Gamma - Focus",
                    432: "Cosmic Tuning (A=432Hz)",
                    440: "Standard Tuning (A)",
                    256: "C Note - Root",
                    288: "D Note - Creativity",
                    324: "E Note - Heart",
                    384: "G Note - Spiritual",
                    216: "Third Eye",
                    243: "Crown Chakra",
                    512: "C Octave - Higher Consciousness",
                    194.18: "Root Chakra",
                    210.42: "Sacral Chakra",
                    126.22: "Solar Plexus Chakra",
                    136.10: "Heart Chakra",
                    141.27: "Throat Chakra",
                    172.06: "Third Eye Chakra",
                    221.23: "Crown Chakra",
                    194.71: "Earth Frequency",
                    207.36: "Moon Frequency",
                    221.23: "Venus Frequency",
                    234.16: "Mars Frequency",
                    146.83: "Jupiter Frequency",
                    183.58: "Saturn Frequency",
                    172.06: "Neptune Frequency"
                }
            },
            hu: {
                appTitle: "Digitális Frekvencia Gyógyszertár",
                appSubtitle: "Professzionális Hangterápia",
                masterVolLabel: "Fő Hangerő",
                breathingLabel: "Légzés Effekt (LFO)",
                brownNoiseLabel: "Barna Zaj Réteg",
                stopText: "Minden Leállítása",
                themeText: "Világos Mód",
                langText: "EN",
                solfeggioTitle: "Solfeggio Frekvenciák",
                rifeTitle: "Rife Frekvenciák",
                brainwaveTitle: "Agyhullám Frekvenciák",
                chineseTitle: "Kínai Pentatonikus & Harmonikus Frekvenciák",
                chakraTitle: "Csakra Frekvenciák",
                planetaryTitle: "Planetáris Frekvenciák",
                ambientTitle: "Környezeti Zaj Rétegek",
                pinkNoiseLabel: "Rózsaszín Zaj (1/f)",
                whiteNoiseLabel: "Fehér Zaj",
                rainNoiseLabel: "Eső Szimuláció",
                statusText: "Aktív",
                frequencies: {
                    174: "Fájdalomcsillapítás",
                    285: "Szövet Gyógyítás",
                    396: "Felszabadulás a Félelemtől",
                    417: "Változás Elősegítése",
                    528: "DNS Javítás",
                    639: "Kapcsolatok & Összekapcsolódás",
                    741: "Intuíció Ébredése",
                    852: "Spirituális Rend",
                    963: "Isteni Tudat",
                    727: "Általános Gyógyítás",
                    802: "Fertőzés Elleni Védekezés",
                    1550: "Sérülés Helyreállítás",
                    5000: "Regeneráció",
                    10000: "Teljes Spektrumú Gyógyítás",
                    7.83: "Schumann Rezonancia",
                    4: "Delta - Mély Alvás",
                    10: "Alpha - Relaxáció",
                    40: "Gamma - Fókusz",
                    432: "Kozmikus Hangolás (A=432Hz)",
                    440: "Standard Hangolás (A)",
                    256: "C Jegyzet - Gyökér",
                    288: "D Jegyzet - Kreativitás",
                    324: "E Jegyzet - Szív",
                    384: "G Jegyzet - Spirituális",
                    216: "Harmadik Szem",
                    243: "Koronacsakra",
                    512: "C Oktáv - Magasabb Tudat",
                    194.18: "Gyökércsakra",
                    210.42: "Keresztcsonti Csakra",
                    126.22: "Napfonat Csakra",
                    136.10: "Szívcsakra",
                    141.27: "Torkcsakra",
                    172.06: "Harmadik Szem Csakra",
                    221.23: "Koronacsakra",
                    194.71: "Föld Frekvencia",
                    207.36: "Hold Frekvencia",
                    221.23: "Vénusz Frekvencia",
                    234.16: "Mars Frekvencia",
                    146.83: "Jupiter Frekvencia",
                    183.58: "Szaturnusz Frekvencia",
                    172.06: "Neptunusz Frekvencia"
                }
            }
        };

        // Frequency definitions
        const frequencies = {
            solfeggio: [174, 285, 396, 417, 528, 639, 741, 852, 963],
            rife: [727, 802, 1550, 5000, 10000],
            brainwave: [7.83, 4, 10, 40],
            chinese: [432, 440, 256, 288, 324, 384, 216, 243, 512],
            chakra: [194.18, 210.42, 126.22, 136.10, 141.27, 172.06, 221.23],
            planetary: [194.71, 207.36, 221.23, 234.16, 146.83, 183.58, 172.06]
        };

        // Audio context and nodes
        let audioCtx = null;
        let masterGain = null;
        let lfoOsc = null;
        let lfoGain = null;
        let brownNoiseNode = null;
        let brownNoiseGain = null;
        let pinkNoiseNode = null;
        let pinkNoiseGain = null;
        let whiteNoiseNode = null;
        let whiteNoiseGain = null;
        let rainNode = null;
        let rainGain = null;
        const oscillators = {};
        const gainNodes = {};
        const currentFreqs = {};

        // State
        let currentLang = 'en';
        let activeCount = 0;

        // Initialize audio context
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioCtx.createGain();
                masterGain.connect(audioCtx.destination);
                masterGain.gain.value = 0.5;

                // LFO setup
                lfoOsc = audioCtx.createOscillator();
                lfoGain = audioCtx.createGain();
                lfoOsc.frequency.value = 0.2; // Slow breathing rhythm
                lfoGain.gain.value = 0;
                lfoOsc.connect(lfoGain);
                lfoGain.connect(masterGain.gain);
                lfoOsc.start();

                // Brown noise setup
                setupBrownNoise();
                
                // Pink noise setup
                setupPinkNoise();
                
                // White noise setup
                setupWhiteNoise();
                
                // Rain simulation setup
                setupRainNoise();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function setupBrownNoise() {
            const bufferSize = 4096;
            const brownNoise = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            let lastOut = 0;
            
            brownNoise.onaudioprocess = function(e) {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    output[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = output[i];
                    output[i] *= 3.5;
                }
            };

            brownNoiseGain = audioCtx.createGain();
            brownNoiseGain.gain.value = 0;
            brownNoise.connect(brownNoiseGain);
            brownNoiseGain.connect(masterGain);
            brownNoiseNode = brownNoise;
        }

        function setupPinkNoise() {
            const bufferSize = 4096;
            const pinkNoise = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            let b0 = 0, b1 = 0, b2 = 0, b3 = 0, b4 = 0, b5 = 0, b6 = 0;
            
            pinkNoise.onaudioprocess = function(e) {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    b0 = 0.99886 * b0 + white * 0.0555179;
                    b1 = 0.99332 * b1 + white * 0.0750759;
                    b2 = 0.96900 * b2 + white * 0.1538520;
                    b3 = 0.86650 * b3 + white * 0.3104856;
                    b4 = 0.55000 * b4 + white * 0.5329522;
                    b5 = -0.7616 * b5 - white * 0.0168980;
                    output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                    output[i] *= 0.11;
                    b6 = white * 0.115926;
                }
            };

            pinkNoiseGain = audioCtx.createGain();
            pinkNoiseGain.gain.value = 0;
            pinkNoise.connect(pinkNoiseGain);
            pinkNoiseGain.connect(masterGain);
            pinkNoiseNode = pinkNoise;
        }

        function setupWhiteNoise() {
            const bufferSize = 4096;
            const whiteNoise = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            
            whiteNoise.onaudioprocess = function(e) {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
            };

            whiteNoiseGain = audioCtx.createGain();
            whiteNoiseGain.gain.value = 0;
            whiteNoise.connect(whiteNoiseGain);
            whiteNoiseGain.connect(masterGain);
            whiteNoiseNode = whiteNoise;
        }

        function setupRainNoise() {
            const bufferSize = 4096;
            const rainNoise = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            let bandpass = audioCtx.createBiquadFilter();
            bandpass.type = 'bandpass';
            bandpass.frequency.value = 1000;
            bandpass.Q.value = 0.5;
            
            rainNoise.onaudioprocess = function(e) {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    // Simulate rain drops with random bursts
                    if (Math.random() > 0.98) {
                        output[i] = (Math.random() * 2 - 1) * 0.5;
                    } else {
                        output[i] = (Math.random() * 2 - 1) * 0.05;
                    }
                }
            };

            rainGain = audioCtx.createGain();
            rainGain.gain.value = 0;
            rainNoise.connect(bandpass);
            bandpass.connect(rainGain);
            rainGain.connect(masterGain);
            rainNode = rainNoise;
        }

        function startFrequency(freq) {
            if (oscillators[freq]) return;
            
            initAudio();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine';
            osc.frequency.value = freq;
            gain.gain.value = 0.3;
            
            osc.connect(gain);
            gain.connect(masterGain);
            
            osc.start();
            
            oscillators[freq] = osc;
            gainNodes[freq] = gain;
            currentFreqs[freq] = freq;
            
            activeCount++;
            updateStatus();
        }

        function stopFrequency(freq) {
            if (oscillators[freq]) {
                oscillators[freq].stop();
                delete oscillators[freq];
                delete gainNodes[freq];
                delete currentFreqs[freq];
                activeCount--;
                updateStatus();
            }
        }

        function updateFrequency(oldFreq, newFreq) {
            if (oscillators[oldFreq]) {
                const gain = gainNodes[oldFreq];
                stopFrequency(oldFreq);
                
                const osc = audioCtx.createOscillator();
                osc.type = 'sine';
                osc.frequency.value = newFreq;
                gain.gain.value = gain.gain.value;
                
                osc.connect(gain);
                gain.connect(masterGain);
                osc.start();
                
                oscillators[newFreq] = osc;
                gainNodes[newFreq] = gain;
                currentFreqs[oldFreq] = newFreq;
            }
        }

        function stopAll() {
            // Stop all oscillators
            Object.keys(oscillators).forEach(freq => {
                if (oscillators[freq] && oscillators[freq].stop) {
                    oscillators[freq].stop();
                }
                delete oscillators[freq];
                delete gainNodes[freq];
            });
            
            // Reset all UI cards
            Object.keys(currentFreqs).forEach(baseFreq => {
                const card = document.querySelector(`[data-freq="${baseFreq}"]`);
                if (card) {
                    const toggle = card.querySelector('.toggle-btn');
                    toggle.classList.remove('active');
                    card.classList.remove('active');
                }
                delete currentFreqs[baseFreq];
            });
            
            activeCount = 0;
            updateStatus();
        }

        function updateStatus() {
            const status = document.getElementById('statusIndicator');
            if (activeCount > 0) {
                status.style.display = 'flex';
            } else {
                status.style.display = 'none';
            }
        }

        function createFrequencyCard(freq, category) {
            const card = document.createElement('div');
            card.className = 'freq-card';
            card.setAttribute('data-freq', freq);
            
            const name = translations[currentLang].frequencies[freq];
            
            card.innerHTML = `
                <div class="freq-header">
                    <div class="freq-info">
                        <div class="freq-hz">${freq} Hz</div>
                        <div class="freq-name">${name}</div>
                    </div>
                    <div class="toggle-btn" data-freq="${freq}"></div>
                </div>
                <div class="freq-controls">
                    <div class="fine-tune">
                        <button class="fine-tune-btn" data-action="decrease">−</button>
                        <div class="current-freq">${freq} Hz</div>
                        <button class="fine-tune-btn" data-action="increase">+</button>
                    </div>
                    <div class="control-label" style="margin-bottom: 10px;">Volume</div>
                    <div class="slider-container">
                        <input type="range" class="freq-volume" min="0" max="100" value="30">
                        <span class="value-display">30%</span>
                    </div>
                </div>
            `;
            
            const toggle = card.querySelector('.toggle-btn');
            const volumeSlider = card.querySelector('.freq-volume');
            const volumeValue = card.querySelector('.value-display');
            const currentFreqDisplay = card.querySelector('.current-freq');
            const decreaseBtn = card.querySelector('[data-action="decrease"]');
            const increaseBtn = card.querySelector('[data-action="increase"]');
            
            toggle.addEventListener('click', () => {
                const isActive = toggle.classList.contains('active');
                if (isActive) {
                    stopFrequency(currentFreqs[freq] || freq);
                    toggle.classList.remove('active');
                    card.classList.remove('active');
                } else {
                    startFrequency(freq);
                    toggle.classList.add('active');
                    card.classList.add('active');
                }
            });
            
            volumeSlider.addEventListener('input', (e) => {
                const value = e.target.value;
                volumeValue.textContent = `${value}%`;
                const actualFreq = currentFreqs[freq] || freq;
                if (gainNodes[actualFreq]) {
                    gainNodes[actualFreq].gain.value = value / 100;
                }
            });
            
            decreaseBtn.addEventListener('click', () => {
                const currentVal = currentFreqs[freq] || freq;
                const newVal = Math.max(1, currentVal - 1);
                currentFreqs[freq] = newVal;
                currentFreqDisplay.textContent = `${newVal.toFixed(2)} Hz`;
                if (oscillators[currentVal]) {
                    updateFrequency(currentVal, newVal);
                }
            });
            
            increaseBtn.addEventListener('click', () => {
                const currentVal = currentFreqs[freq] || freq;
                const newVal = currentVal + 1;
                currentFreqs[freq] = newVal;
                currentFreqDisplay.textContent = `${newVal.toFixed(2)} Hz`;
                if (oscillators[currentVal]) {
                    updateFrequency(currentVal, newVal);
                }
            });
            
            return card;
        }

        function renderFrequencies() {
            const solfeggioGrid = document.getElementById('solfeggioGrid');
            const rifeGrid = document.getElementById('rifeGrid');
            const brainwaveGrid = document.getElementById('brainwaveGrid');
            const chineseGrid = document.getElementById('chineseGrid');
            const chakraGrid = document.getElementById('chakraGrid');
            const planetaryGrid = document.getElementById('planetaryGrid');
            
            if (solfeggioGrid) solfeggioGrid.innerHTML = '';
            if (rifeGrid) rifeGrid.innerHTML = '';
            if (brainwaveGrid) brainwaveGrid.innerHTML = '';
            if (chineseGrid) chineseGrid.innerHTML = '';
            if (chakraGrid) chakraGrid.innerHTML = '';
            if (planetaryGrid) planetaryGrid.innerHTML = '';
            
            if (solfeggioGrid) {
                frequencies.solfeggio.forEach(freq => {
                    solfeggioGrid.appendChild(createFrequencyCard(freq, 'solfeggio'));
                });
            }
            
            if (rifeGrid) {
                frequencies.rife.forEach(freq => {
                    rifeGrid.appendChild(createFrequencyCard(freq, 'rife'));
                });
            }
            
            if (brainwaveGrid) {
                frequencies.brainwave.forEach(freq => {
                    brainwaveGrid.appendChild(createFrequencyCard(freq, 'brainwave'));
                });
            }
            
            if (chineseGrid) {
                frequencies.chinese.forEach(freq => {
                    chineseGrid.appendChild(createFrequencyCard(freq, 'chinese'));
                });
            }
            
            if (chakraGrid) {
                frequencies.chakra.forEach(freq => {
                    chakraGrid.appendChild(createFrequencyCard(freq, 'chakra'));
                });
            }
            
            if (planetaryGrid) {
                frequencies.planetary.forEach(freq => {
                    planetaryGrid.appendChild(createFrequencyCard(freq, 'planetary'));
                });
            }
        }

        function updateLanguage() {
            const t = translations[currentLang];
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('masterVolLabel').textContent = t.masterVolLabel;
            document.getElementById('breathingLabel').textContent = t.breathingLabel;
            document.getElementById('brownNoiseLabel').textContent = t.brownNoiseLabel;
            document.getElementById('stopText').textContent = t.stopText;
            document.getElementById('themeText').textContent = t.themeText;
            document.getElementById('langText').textContent = t.langText;
            document.getElementById('statusText').textContent = t.statusText;
            
            // Check if elements exist before setting textContent
            const solfeggioTitle = document.getElementById('solfeggioTitle');
            const rifeTitle = document.getElementById('rifeTitle');
            const brainwaveTitle = document.getElementById('brainwaveTitle');
            const chineseTitle = document.getElementById('chineseTitle');
            const chakraTitle = document.getElementById('chakraTitle');
            const planetaryTitle = document.getElementById('planetaryTitle');
            const pinkNoiseLabel = document.getElementById('pinkNoiseLabel');
            const whiteNoiseLabel = document.getElementById('whiteNoiseLabel');
            const rainNoiseLabel = document.getElementById('rainNoiseLabel');
            
            if (solfeggioTitle) solfeggioTitle.textContent = t.solfeggioTitle;
            if (rifeTitle) rifeTitle.textContent = t.rifeTitle;
            if (brainwaveTitle) brainwaveTitle.textContent = t.brainwaveTitle;
            if (chineseTitle) chineseTitle.textContent = t.chineseTitle;
            if (chakraTitle) chakraTitle.textContent = t.chakraTitle;
            if (planetaryTitle) planetaryTitle.textContent = t.planetaryTitle;
            if (pinkNoiseLabel) pinkNoiseLabel.textContent = t.pinkNoiseLabel;
            if (whiteNoiseLabel) whiteNoiseLabel.textContent = t.whiteNoiseLabel;
            if (rainNoiseLabel) rainNoiseLabel.textContent = t.rainNoiseLabel;
            
            renderFrequencies();
        }

        // Event listeners
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('light');
            document.body.classList.toggle('dark');
            const isLight = document.body.classList.contains('light');
            document.getElementById('themeText').textContent = isLight ? 
                translations[currentLang === 'en' ? 'en' : 'hu'].themeText.replace('Light', 'Dark').replace('Világos', 'Sötét') : 
                translations[currentLang].themeText;
        });

        document.getElementById('langToggle').addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'hu' : 'en';
            updateLanguage();
        });

        document.getElementById('stopAll').addEventListener('click', stopAll);

        document.getElementById('masterVol').addEventListener('input', (e) => {
            const value = e.target.value / 100;
            document.getElementById('masterVolValue').textContent = `${e.target.value}%`;
            if (masterGain) {
                masterGain.gain.value = value;
            }
        });

        document.getElementById('lfoDepth').addEventListener('input', (e) => {
            const value = e.target.value / 100;
            document.getElementById('lfoValue').textContent = `${e.target.value}%`;
            if (lfoGain) {
                lfoGain.gain.value = value * 0.3;
            }
        });

        document.getElementById('brownNoise').addEventListener('input', (e) => {
            initAudio(); // Make sure audio is initialized
            const value = e.target.value / 100;
            document.getElementById('brownNoiseValue').textContent = `${e.target.value}%`;
            if (brownNoiseGain) {
                brownNoiseGain.gain.value = value * 0.15;
            }
        });

        document.getElementById('pinkNoise').addEventListener('input', (e) => {
            initAudio(); // Make sure audio is initialized
            const value = e.target.value / 100;
            document.getElementById('pinkNoiseValue').textContent = `${e.target.value}%`;
            if (pinkNoiseGain) {
                pinkNoiseGain.gain.value = value * 0.2;
            }
        });

        document.getElementById('whiteNoise').addEventListener('input', (e) => {
            initAudio(); // Make sure audio is initialized
            const value = e.target.value / 100;
            document.getElementById('whiteNoiseValue').textContent = `${e.target.value}%`;
            if (whiteNoiseGain) {
                whiteNoiseGain.gain.value = value * 0.1;
            }
        });

        document.getElementById('rainNoise').addEventListener('input', (e) => {
            initAudio(); // Make sure audio is initialized
            const value = e.target.value / 100;
            document.getElementById('rainNoiseValue').textContent = `${e.target.value}%`;
            if (rainGain) {
                rainGain.gain.value = value * 0.25;
            }
        });

        // Service Worker Registration with proper PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'freq-pharmacy-v1.0.0';
                    const urlsToCache = [
                        '/',
                        './'
                    ];

                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => {
                                    console.log('Cache opened');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request).then(
                                        (response) => {
                                            if (!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            const responseToCache = response.clone();
                                            caches.open(CACHE_NAME)
                                                .then((cache) => {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            return response;
                                        }
                                    );
                                })
                        );
                    });

                    self.addEventListener('activate', (event) => {
                        const cacheWhitelist = [CACHE_NAME];
                        event.waitUntil(
                            caches.keys().then((cacheNames) => {
                                return Promise.all(
                                    cacheNames.map((cacheName) => {
                                        if (cacheWhitelist.indexOf(cacheName) === -1) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL)
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // Create and inject manifest.json dynamically
        const manifestData = {
            "name": "Digital Frequency Pharmacy",
            "short_name": "Freq Pharmacy",
            "description": "Professional Sound Therapy & Frequency Healing PWA by MysteryT",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#1a1a2e",
            "theme_color": "#1a1a2e",
            "orientation": "portrait-primary",
            "scope": "./",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192'%3E%3Crect width='192' height='192' fill='%231a1a2e'/%3E%3Ctext x='50%25' y='50%25' font-size='80' fill='%236adcff' dominant-baseline='middle' text-anchor='middle'%3E∿%3C/text%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512'%3E%3Crect width='512' height='512' fill='%231a1a2e'/%3E%3Ctext x='50%25' y='50%25' font-size='200' fill='%236adcff' dominant-baseline='middle' text-anchor='middle'%3E∿%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ],
            "screenshots": [],
            "categories": ["health", "lifestyle", "wellness"],
            "shortcuts": []
        };

        const manifestJSON = JSON.stringify(manifestData);
        const manifestBlob = new Blob([manifestJSON], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);

        // Initialize
        renderFrequencies();
        updateLanguage();

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA install prompt ready');
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            deferredPrompt = null;
        });
    </script>
</body>
</html>